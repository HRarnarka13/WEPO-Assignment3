angular.module("TeachingEvaluations",["ngRoute"]),angular.module("TeachingEvaluations").config(["$routeProvider",function(a){a.when("/login",{templateUrl:"src/views/login.html",controller:"LoginController"}).when("/evaluations/:user",{templateUrl:"src/views/evaluations.html",controller:"EvaluationsController"}).when("/courses/:courseID/:semesterID/evaluations/:evalID",{templateUrl:"src/views/evaluation.html",controller:"EvaluationController"}).when("/admin/evaluations",{templateUrl:"src/views/adminEvaluations.html",controller:"AdminEvaluationsController"}).when("/admin/evaluation/:evalID",{templateUrl:"src/views/adminEvaluation.html",controller:"AdminEvaluationController"}).when("/admin/evaluationtemplates/:ID",{templateUrl:"src/views/evaluationTemplate.html",controller:"EvaluationTemplateController"}).when("/admin/newtemplate",{templateUrl:"src/views/newTemplate.html",controller:"NewTemplateController"}).otherwise({redirectTo:"/login"})}]),angular.module("TeachingEvaluations").controller("AdminEvaluationController",["$scope","$location","$rootScope","$routeParams","$http","Dispatch",function(a,b,c,d,e,f){f.getEvaluation(d.evalID).success(function(a){console.log(a)})}]),angular.module("TeachingEvaluations").controller("AdminEvaluationsController",["$scope","$location","$rootScope","$routeParams","$http","Dispatch",function(a,b,c,d,e,f){f.getEvaluations().success(function(b){a.evaluations=b}),f.getEvaluationTemplates().success(function(b){console.log(b),a.templates=b})}]),angular.module("TeachingEvaluations").controller("EvaluationController",["$scope","$location","$rootScope","$routeParams","$http","Dispatch",function(a,b,c,d,e,f){a.username=d.user,a.cID=d.courseID,a.semesterID=d.semesterID,a.evalID=d.evalID,f.getMyEvaluation(a.cID,a.semesterID,a.evalID).success(function(b){console.log(b),a.introText=b.IntroText,a.title=b.Title,a.courseQuestions=b.CourseQuestions,a.teacherQuestions=b.TeacherQuestions,console.log(a.courseQuestions)}),f.getTeachers(a.cID,a.semesterID).success(function(b){console.log(b),a.teachers=b}),a.submitAnswers=function(){a.evaluationForm.$valid&&(console.log("Answers:"),console.log(a.evaluationForm)),console.log(a.evaluationForm)}}]),angular.module("TeachingEvaluations").controller("EvaluationTemplateController",["$scope","$location","$rootScope","$routeParams","$http","Dispatch",function(a,b,c,d,e,f){a.showQuestion=!1,a.showEvaluation=!1,f.getEvaluationTemplate(d.ID).success(function(b){a.template=b,console.log("EvaluationTemplateController"),console.log(b),a.newQuestion=function(){console.log("newQuestion")}}),a.createEvaluation=function(){console.log("Before dispatch");var c=a.startDate.toISOString(),e=a.endDate.toISOString();f.postEvaluation(d.ID,c,e).success(function(){b.path("/admin/evaluations/")})},a.toggle=function(){a.showQuestion=!a.showQuestion},a.toggle2=function(){a.showEvaluation=!a.showEvaluation}}]),angular.module("TeachingEvaluations").controller("EvaluationsController",["$scope","$location","$rootScope","$routeParams","$http","Dispatch",function(a,b,c,d,e,f){function g(b){for(var c=a.courses.length-1;c>=0;c--)if(a.courses[c].CourseID===b)return!0;return!1}a.username=d.user,a.courses=[],f.getMyEvaluations().success(function(b){for(var c=0;c<b.length;c++){if(!g(b[c].CourseID)){var d={CourseID:b[c].CourseID,CourseName:b[c].CourseName,Semester:b[c].Semester,Evaluations:[]};a.courses.push(d)}for(var e=0;e<a.courses.length;e++)a.courses[e].CourseID===b[c].CourseID&&a.courses[e].Evaluations.push(b[c])}})}]),angular.module("TeachingEvaluations").controller("LoginController",["$scope","$location","$rootScope","$routeParams","$http","Dispatch",function(a,b,c,d,e,f){a.errorMessage="",a.username="",a.password="",a.login=function(){a.loginForm.$valid&&f.login(a.username,a.password).success(function(c){a.failToLogin=!1,e.defaults.headers.common.Authorization="Basic "+c.Token,a.role=c.User.Role,b.path("admin"===a.role?"/admin/evaluations/":"/evaluations/"+a.username)}).error(function(){a.errorMessage="Username or password incorrect!",a.failToLogin=!0})}}]),angular.module("TeachingEvaluations").controller("NewTemplateController",["$scope","$location","$rootScope","$routeParams","$http","Dispatch",function(a){a.createTemplate=function(){console.log("createTemplate")}}]),angular.module("TeachingEvaluations").directive("evaluationQuestion",function(){return{restrict:"E",require:"^form",templateUrl:"src/views/evaluationQuestion.html",scope:{question:"="},link:function(a){console.log(a.question)}}}),angular.module("TeachingEvaluations").factory("Dispatch",["$http","SERVER_URL",function(a,b){return{login:function(c,d){return a.post(b+"/login",{user:c,pass:d})},getEvaluations:function(){return a.get(b+"/evaluations")},getEvaluation:function(c){return a.get(b+"/evaluations/"+c)},getEvaluationTemplates:function(){return a.get(b+"/evaluationtemplates/")},getEvaluationTemplate:function(c){return a.get(b+"/evaluationtemplates/"+c)},postEvaluation:function(c,d,e){return a.post(b+"/evaluations",{TemplateID:c,StartDate:d,EndDate:e})},getMyEvaluations:function(){return a.get(b+"/my/evaluations")},getMyEvaluation:function(c,d,e){return a.get(b+"/courses/"+c+"/"+d+"/evaluations/"+e)},getTeachers:function(c,d){return a.get(b+"/courses/"+c+"/"+d+"/teachers")}}}]),angular.module("TeachingEvaluations").constant("SERVER_URL","http://dispatch.ru.is/demo/api/v1");